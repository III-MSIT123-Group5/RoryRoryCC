@using BusinessSystemMVC_Admin_page_.Models

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @RenderSection("styles", required: false)
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.5/umd/popper.js"></script>
    @*<link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
        <link href="https://cdn.datatables.net/fixedheader/3.1.3/css/fixedHeader.dataTables.min.css" rel="stylesheet" />
        <script src="https://cdn.datatables.net/fixedheader/3.1.3/js/dataTables.fixedHeader.min.js"></script>*@

    <link href="~/Content/jquery-ui.css" rel="stylesheet" />
    <link href="~/Content/jquery-ui.structure.css" rel="stylesheet" />
    <link href="~/Content/jquery-ui.theme.css" rel="stylesheet" />

    <title>Business System</title>
</head>
<body class="fixed-nav sticky-footer bg-dark" id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
        <a class="navbar-brand" href="@Url.Action("Index", "Home")" . style="line-height:50px; margin-left:5px">Business System</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav navbar-sidenav" id="exampleAccordion" style="background-color:white; overflow-y:auto; padding-bottom:28px">
                @*公佈欄*@
                <li class="nav-item color hover" data-toggle="tooltip" data-placement="right" title="公佈欄">
                    <a class="nav-link" href="@Url.Action("Index", "BulletinBoards")">
                        <i class="fa fa-fw fa-bullhorn"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">公佈欄</span>
                    </a>
                </li>
                @*公務車*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="公務車">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseBussinessCar" data-parent="#exampleAccordion">
                        <i class="fa fa-fw fa-car"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">公務車</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseBussinessCar">
                        @Html.Partial("_CompanyVehicleChangePartial")
                        <li class="color hover">
                            <a href="@Url.Action("Index","CompanyVehicleBorrow")" style="font-family:'NotoSansCJKtc-Bold'">公務車預約</a>
                        </li>
                        <li class="color hover">
                            <a href="@Url.Action("Index","CompanyVehicleHistories")" style="font-family:'NotoSansCJKtc-Bold'">公務車預約紀錄</a>
                        </li>
                    </ul>
                </li>
                @*會議室*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="會議室">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseMeetingRoom" data-parent="#exampleAccordion">
                        <i class="fa fa-fw fa-users"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">會議室</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseMeetingRoom">
                        @Html.Partial("_MeetingRoomChangePartial")
                        <li class="color hover">
                            <a href="@Url.Action("Index","MeetingRoomsBorrow")" style="font-family:'NotoSansCJKtc-Bold'">會議室預約</a>
                        </li>
                        <li class="color hover">
                            <a href="@Url.Action("Index","MeetingRoomHistories")" style="font-family:'NotoSansCJKtc-Bold'">會議室預約紀錄</a>
                        </li>
                    </ul>
                </li>
                @*行事曆*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="行事曆">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseCalendar" data-parent="#exampleAccordion">
                        <i class="fa fa-fw fa-calendar"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">行事曆</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseCalendar">
                        <li class="color hover">
                            <a href="@Url.Action("Index", "EventCalendars")" style="font-family:'NotoSansCJKtc-Bold'">行事曆</a>
                        </li>
                        <li class="color hover">
                            <a href="calendar.html" style="font-family:'NotoSansCJKtc-Bold'">統計分析</a>
                        </li>
                    </ul>
                </li>
                @*檔案管理*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="檔案管理">
                    <a class="nav-link" href="@Url.Action("Index", "Files")">
                        <i class="fa fa-fw fa-file"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">檔案管理</span>
                    </a>
                </li>
                @*意見調查*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="意見調查">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseCommentMains" data-parent="#exampleAccordion">
                        <i class="fa fa-fw fa-clipboard"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">意見調查</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseCommentMains">
                        <li class="color hover">
                            <a href="@Url.Action("ViewContent","CommentMains")" style="font-family:'NotoSansCJKtc-Bold'">編寫調查</a>
                        </li>
                        <li class="color hover">
                            <a href="@Url.Action("Index","CompanyVehicleBorrow")" style="font-family:'NotoSansCJKtc-Bold'">回覆調查</a>
                        </li>
                    </ul>
                </li>
                @*內部訊息*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="內部訊息">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseMessage" data-parent="#exampleAccordion">
                        <i class="fa fa-fw fa-comment"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">內部訊息</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseMessage">
                        <li class="color hover">
                            <a href="@Url.Action("Index", "Recipients")" style="font-family:'NotoSansCJKtc-Bold'">收件夾</a>
                        </li>
                        <li class="color hover">
                            <a href="@Url.Action("MessageIndex", "Recipients")" style="font-family:'NotoSansCJKtc-Bold'">寄件夾</a>
                        </li>
                    </ul>

                </li>
                @*請假系統*@
                <li class="nav-item  color hover" data-toggle="tooltip" data-placement="right" title="請假系統">
                    <a class="nav-link" href="@Url.Action("Index", "LeaveHistoryApprovalTemps")">
                        <i class="fa fa-fw fa-clipboard"></i>
                        <span class="nav-link-text" style="font-family:'NotoSansCJKtc-Bold'">請假系統</span>
                    </a>
                </li>
                @*請購系統*@
                @Html.Partial("_RequisitionSystemPartial")
                @*只有組級上以可看見SignOffsystem*@
                @Html.Partial("_SignOffSystemPartial")
                @*只有HR可看見HRsystem*@
                @Html.Partial("_HRSystemPartial")
                @*只有IT可看見HRsystem*@
                @Html.Partial("_ITSystemPartial")
            </ul>
            <ul class="navbar-nav sidenav-toggler" style=" border-right: 1px solid lightgray">
                <li class="nav-item color hover">
                    <a class="nav-link text-center color hover" id="sidenavToggler">
                        <i class="fa fa-fw fa-angle-left"></i>
                    </a>
                </li>
            </ul>
            <div class="navbar-nav ml-auto">
                @Html.Partial("_LoginPartial")
                @RenderSection("scripts2", required: false)
            </div>
            @*<ul class="navbar-nav ml-auto">
                    <div>  @Html.Partial("_LoginPartial")</div>
                </ul>*@
        </div>
    </nav>
    <div class="content-wrapper" style="padding-left:50px; border-left: 1px solid lightgray">
        <!-- /.container-fluid-->
        <!-- /.content-wrapper-->        
        <br />
        @RenderBody()
        <footer class="sticky-footer color">
            <div class="container">
                <div class="text-center">
                    <small>Copyright © Your Website 2018</small>
                </div>
            </div>
        </footer>
        <!-- Scroll to Top Button-->
        <a class="scroll-to-top rounded" href="#page-top">
            <i class="fa fa-angle-up"></i>
        </a>
        <!-- Logout Modal-->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                        <a class="btn btn-primary" href="login.html">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")

    <script>
        (function ($) {
            "use strict"; // Start of use strict
            // Configure tooltips for collapsed side navigation
            $('.navbar-sidenav [data-toggle="tooltip"]').tooltip({
                template: '<div class="tooltip navbar-sidenav-tooltip" role="tooltip" style="pointer-events: none;"><div class="arrow"></div><div class="tooltip-inner"></div></div>'
            })
            // Toggle the side navigation
            $("#sidenavToggler").click(function (e) {
                e.preventDefault();
                $("body").toggleClass("sidenav-toggled");
                $(".navbar-sidenav .nav-link-collapse").addClass("collapsed");
                $(".navbar-sidenav .sidenav-second-level, .navbar-sidenav .sidenav-third-level").removeClass("show");
            });
            // Force the toggled class to be removed when a collapsible nav link is clicked
            $(".navbar-sidenav .nav-link-collapse").click(function (e) {
                e.preventDefault();
                $("body").removeClass("sidenav-toggled");
            });
            // Prevent the content wrapper from scrolling when the fixed side navigation hovered over
            $('body.fixed-nav .navbar-sidenav, body.fixed-nav .sidenav-toggler, body.fixed-nav .navbar-collapse').on('mousewheel DOMMouseScroll', function (e) {
                var e0 = e.originalEvent,
                    delta = e0.wheelDelta || -e0.detail;
                this.scrollTop += (delta < 0 ? 1 : -1) * 30;
                e.preventDefault();
            });
            // Scroll to top button appear
            $(document).scroll(function () {
                var scrollDistance = $(this).scrollTop();
                if (scrollDistance > 100) {
                    $('.scroll-to-top').fadeIn();
                } else {
                    $('.scroll-to-top').fadeOut();
                }
            });
            // Configure tooltips globally
            $('[data-toggle="tooltip"]').tooltip()
            // Smooth scrolling using jQuery easing
            $(document).on('click', 'a.scroll-to-top', function (event) {
                var $anchor = $(this);
                $('html, body').stop().animate({
                    scrollTop: ($($anchor.attr('href')).offset().top)
                }, 1000, 'easeInOutExpo');
                event.preventDefault();
            });
        })(jQuery); // End of use strict
    </script>

    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/notify.min.js"></script>
    <script>
        //取得現在時間以及現在時間的小時，分鐘
        var timing = new Date();
        var hour = timing.getHours();
        var mins = timing.getMinutes();
        var apm;
        //
        $(document).ready(function () {
            getlocation()
        })
        //每隔15秒刷新一次小鈴鐺
        function funcTimer() {
            window.setInterval("getlocation()", 60000);
        }

        window.onload = funcTimer;

        //<><><><><><><><><把需要刷新的方法放在這><><><><><><><><><><
        function getlocation() {
            $("#appendnews").empty();
            getVehicleData();
            getMeetingData()
            //.....
        }
        //判斷上午還是下午
        function ampm() {
            if (hour > 12) {
                apm = " PM"
            }
            else {
                apm=" AM"
            }
        }
        
        //
        //timestampToTime(*可放入時間戳*)，此方法可將時間戳13位數形式轉為正常時間格式
        //時間戳為10位數需*1000，時間戳為13位數則不需*1000 !!!!!!!!!!!!!!!!!!!!!!!!!!!!
        function timestampToTime(timestamp) {

            var date = new Date(timestamp);//時間戳為10位數需*1000，時間戳為13位數則不需*1000

            var Y = date.getFullYear() + '-';

            var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';

            var D = date.getDate() + ' ';

            var h = date.getHours() + ':';

            var m = date.getMinutes() + ':';

            var s = date.getSeconds();

            return Y + M + D + h + m + s;
        }

        //------------
        //公務車預約，判斷是否在24小時內，方法。
        function getVehicleData() {
            $.ajax({
                url: '@Url.Action("test1", "CompanyVehicleHistories")',
                type: "GET",
                dataType: "json"
            }).done(function (data) {
                //把現在時間轉成時間戳形式
                var timetroll = timing.getTime()
                //建立迴圈
                for (var i = 0; i < data.length; i++) {
                    //取得車牌號碼
                    var License = data[i].LicenseNumber;;
                    //(data[i].StartDateTime)取得資料庫起始時間的時間戳--數字形式(13位數)，只需修改(data[i].StartDateTime)
                    var Stime = parseInt(String(data[i].StartDateTime).substring(6, 19)); 
                    //---------------------------------
                    //  timetroll : 現在時間時間戳
                    //  Stime : 資料庫車輛預約起始時間
                    //  86400000 : 24小時的時間戳形式
                    //  &&
                    //  timetroll < Stime : 現在時間不能大於車輛預約起始時間
                    //  &&
                    //  判斷紀錄是否為登入者本人的紀錄
                    if (timetroll >= (Stime - 86400000) && timetroll < Stime && @EmployeeDetail.EmployeeID == data[i].employeeID) {
                        ampm();
                        //以下形式未標記(可修改)請勿修改
                        //(公務車預約通知)為通知標題，可修改。!!!!!!!!!!
                        //(${hour}:${mins}${apm})，為取得現在時間，請勿修改。XXXXXX
                        //(公務車(${License})預約時間為:${timestampToTime(Stime)}，請準時取車。)可以修改
                        //timestampToTime(*可放入時間戳*)，此方法可將時間戳13位數形式轉為正常時間格式
                            $("#appendnews").append('<div class="dropdown - divider"></div>')
                            $("#appendnews").append(`<a class="dropdown-item" href="#"><span class="text-success"><strong>
<i class= "fa fa-long-arrow-up fa-fw" ></i> 公務車預約通知</strong></span>
<span class="small float-right text-muted">${hour}:${mins}${apm}</span>
<div class="dropdown-message small">公務車(${License})預約時間為:${timestampToTime(Stime)}，請準時取車。</div></a>`)
                        $("#appendnews").click(function () {

                        })
                        }
                }

            })
        }
        //------------
        //會議室預約，判斷是否在24小時內，方法。
        function getMeetingData() {
            $.ajax({
                url: '@Url.Action("test1", "MeetingRoomHistories")',
                type: "GET",
                dataType: "json"
            }).done(function (data) {
                //把現在時間轉成時間戳形式
                var timetroll = timing.getTime()
                //建立迴圈
                for (var i = 0; i < data.length; i++) {
                    //取得車牌號碼
                    var meetID = data[i].meetingID;
                    var meetName = data[i].RoomName;
                    //(data[i].StartDateTime)取得資料庫起始時間的時間戳--數字形式(13位數)，只需修改(data[i].StartDateTime)
                    var Stime = parseInt(String(data[i].start_date_time).substring(6, 19)); 
                    //---------------------------------
                    //  timetroll : 現在時間時間戳
                    //  Stime : 資料庫車輛預約起始時間
                    //  86400000 : 24小時的時間戳形式
                    //  &&
                    //  timetroll < Stime : 現在時間不能大於車輛預約起始時間
                    //  &&
                    //  判斷紀錄是否為登入者本人的紀錄
                    if (timetroll >= (Stime - 86400000) && timetroll < Stime && @EmployeeDetail.EmployeeID == data[i].employeeID) {
                        ampm();
                        //以下形式未標記(可修改)請勿修改
                        //(公務車預約通知)為通知標題，可修改。!!!!!!!!!!
                        //(${hour}:${mins}${apm})，為取得現在時間，請勿修改。XXXXXX
                        //(公務車(${License})預約時間為:${timestampToTime(Stime)}，請準時取車。)可以修改
                        //timestampToTime(*可放入時間戳*)，此方法可將時間戳13位數形式轉為正常時間格式
                            $("#appendnews").append('<div class="dropdown - divider"></div>')
                            $("#appendnews").append(`<a class="dropdown-item" href="#"><span class="text-success"><strong>
<i class= "fa fa-long-arrow-up fa-fw" ></i> 會議室預約通知</strong></span>
<span class="small float-right text-muted">${hour}:${mins}${apm}</span>
<div class="dropdown-message small">會議室(${meetID}_${meetName})預約時間為:${timestampToTime(Stime)}，請通知與會人員。</div></a>`)
                        $("#appendnews").click(function () {

                        })
                        }
                }

            })
        }
    </script>
    @RenderSection("scripts", required: false)

</body>
</html>
